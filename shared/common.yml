provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  stage: dev
  memorySize: 2048
  timeout: 29
  
  # Construcci칩n din치mica del ARN del Rol usando el .env
  role: arn:aws:iam::${env:AWS_ACCOUNT_ID}:role/LabRole

  environment:
    # Variable global disponible para todos los MS
    NODE_OPTIONS: --enable-source-maps
    EVENT_BUS_NAME: 
      Fn::ImportValue: cw-event-bus-name-${self:provider.stage}
    WEBSOCKET_ENDPOINT: 
        Fn::ImportValue: cw-websocket-endpoint-${self:provider.stage}
    CONNECTIONS_TABLE: 
      Fn::ImportValue: cw-connections-table-name-${self:provider.stage}

# Configuraci칩n centralizada de Esbuild
custom:
  esbuild:
    bundle: true
    minify: false
    sourcemap: true
    target: 'node18'
    packager: 'npm'
    # Importante: Como el tsconfig est치 dentro de cada MS, usamos ./tsconfig.json
    tsconfig: './tsconfig.json'
    exclude: ['aws-sdk', '@aws-sdk/*']