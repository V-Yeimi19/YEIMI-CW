provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  stage: dev
  memorySize: 2048
  timeout: 29
  
  # Construcci칩n din치mica del ARN del Rol usando el .env
  iam:
    role: arn:aws:iam::${aws:accountId}:role/LabRole

  environment:
    # Variable global disponible para todos los MS
    NODE_OPTIONS: --enable-source-maps
    EVENT_BUS_NAME: 
      Fn::ImportValue: cw-event-bus-name-${self:provider.stage}
    WEBSOCKET_ENDPOINT: 
        Fn::ImportValue: cw-websocket-endpoint-${self:provider.stage}
    CONNECTIONS_TABLE: 
      Fn::ImportValue: cw-connections-table-name-${self:provider.stage}
    USER_POOL_CLIENT_ID:
      Fn::ImportValue: cw-auth-client-id-${self:provider.stage}
    USER_POOL_ID:
      Fn::ImportValue: cw-auth-user-pool-id-${self:provider.stage}
    USERS_TABLE:
      Fn::ImportValue: cw-users-table-name-${self:provider.stage}
    INVENTORY_TABLE_NAME:
      Fn::ImportValue: cw-inventory-table-name-${self:provider.stage}
    UNIVERSAL_RELAY_ARN:
      Fn::ImportValue: cw-universal-relay-arn-${self:provider.stage}

# Configuraci칩n centralizada de Esbuild
custom:
  esbuild:
    bundle: true
    minify: false
    sourcemap: true
    target: 'node18'
    packager: 'npm'
    # Importante: Como el tsconfig est치 dentro de cada MS, usamos ./tsconfig.json
    tsconfig: './tsconfig.json'
    exclude: ['aws-sdk', '@aws-sdk/*']